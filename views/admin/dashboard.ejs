<%layout("/layouts/boilerplate")%>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100">

  <!-- Wrapper -->
  <div class="flex">

    <!-- Sidebar -->
    <div class="w-64 bg-white h-screen shadow-lg fixed " style="z-index: -1;">
      <h2 class="text-2xl font-bold text-blue-600 p-6">Admin Panel</h2>

      <ul class="mt-6 space-y-2">
        <li>
          <a href="/admin/dashboard" class="block py-2 px-6 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">
            Dashboard
          </a>
        </li>

        <li>
          <a href="/admin/users" class="block py-2 px-6 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">
            Manage Users
          </a>
        </li>


        <li>
          <a href="/" class="block py-2 px-6 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded">
            Back to Home
          </a>
        </li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="ml-64 flex-1 p-8 ">

      <!-- Header -->
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-semibold text-gray-800">Admin Dashboard</h1>
        <p class="text-gray-500">Welcome, Admin</p>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
          <h3 class="text-gray-500">Total Users</h3>
          <p class="text-3xl font-bold text-gray-800"><%= totalUsers %></p>
        </div>

        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
          <h3 class="text-gray-500">Alumni</h3>
          <p class="text-3xl font-bold text-blue-600"><%= totalAlumni %></p>
        </div>

        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
          <h3 class="text-gray-500">Students</h3>
          <p class="text-3xl font-bold text-green-600"><%= totalStudents %></p>
        </div>

        <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition">
          <h3 class="text-gray-500">Admins</h3>
          <p class="text-3xl font-bold text-blue-600"><%= totalAdmins %></p>
        </div>

        

      </div>

      <!-- Charts -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-10">

        <!-- Registration Chart -->
        <!-- <div class="bg-white p-6 rounded-xl shadow">
          <h3 class="text-lg font-semibold mb-4">User Registrations (Last 7 Days)</h3>
          <canvas id="regChart" height="200"></canvas>
        </div> -->

        <!-- Role Distribution -->
        <div class="bg-white p-6 rounded-xl shadow">
          <h3 class="text-lg font-semibold mb-4">User Roles Distribution</h3>
          <canvas id="roleChart" height="200"></canvas>
        </div>

      </div>

      <!-- Recent Users -->
      <div class="bg-white p-6 rounded-xl shadow mt-10">
        <h3 class="text-lg font-semibold mb-4">Recent Users</h3>

        <table class="w-full text-left">
          <thead>
            <tr class="border-b">
              <th class="py-3">Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Joined</th>
            </tr>
          </thead>

          <tbody>
            <% recentUsers.forEach(u => { %>
              <tr class="border-b hover:bg-gray-50">
                <td class="py-3"><%= u.name %></td>
                <td><%= u.email %></td>
                <td class="capitalize"><%= u.role %></td>
                <td><%= u.createdAt.toLocaleDateString() %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>

      </div>

    </div>

  </div>


<!-- Charts Script -->
<script>
  // Registration Line Chart
  const labels = <%- JSON.stringify(last7Days.map(d => d._id)) %>;
  const regData = <%- JSON.stringify(last7Days.map(d => d.count)) %>;

  new Chart(document.getElementById('regChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: "Registrations",
        data: regData,
        borderWidth: 3
      }]
    }
  });

  // Role Pie Chart
  new Chart(document.getElementById('roleChart'), {
    type: 'pie',
    data: {
      labels: ["Alumni", "Students", "Admins"],
      datasets: [{
        data: [<%= totalAlumni %>, <%= totalStudents %>, <%=totalAdmins%>]
      }]
    }
  });
</script>

</body>
</html>
